var md5 = require('MD5')
	, mysql = require('mysql')
	, MobileLondonDB = 'nodejs_mysql_test'
	, ML_User = 'ML_Users'
	, client = mysql.createClient({
		user: 'root',
		password: 'manutd',
	})
	rs = require('RandomString');
require('date-utils');
module.exports.newUser = function (req, res) {
	var email = JSON.stringify(req.body.email);
	var userPass = rs.generate(8);
	// Check if email address has already been used
	client.query('USE ' + MobileLondonDB);
	client.query('SELECT userEmail FROM ' + ML_User + ' WHERE userEmail = ' + email,
		function selectCb(err, results) {
			if (err) { throw err; }
			if (results[0] != undefined) {
				console.log("exists");
			} else {
				client.query(
				  'INSERT INTO ' + ML_User +
				  ' SET userEmail = ?, userPass = ?',
				  [req.body.email, md5(userPass)]
				);
				console.log("new");
				console.log(req.body.email);
			}
   			client.end();
 		}
	);
	/*client.query('INSERT INTO ' + ML_User + 
		' SET userEmail = ?, userPass = ?',
		[req.body.email, '2419c459e9ad2d94f4a5c887b3ca18cb']
	);*/
	
	bodySend = "User Email: " + req.body.email + "   Password: " + userPass + "   MD5: " + md5(userPass);
	res.send(bodySend);
};